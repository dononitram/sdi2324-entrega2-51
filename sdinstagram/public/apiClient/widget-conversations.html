<div id="widget-conversations">
    <h2>Chats</h2>
    <table class="table table-hover">
        <thead>
            <tr>
                <th>User</th>
                <th>Name</th>
                <th>Surname</th>
                <th class="col-md-1"></th>
            </tr>
        </thead>
        <tbody id="conversationsTableBody">

        </tbody>
    </table>

</div>

<script>

    const getConversations = () => {
        $.ajax({
            url: URLbase + `/conversations?token=${token}`,
            type: "GET",

            success: response => {
                generateTable(response.conversations);
            },
            error: error =>  {
                Cookies.remove('token');
                $("#widget-login")
                    .prepend("<div class='alert alert-danger'>Error fetching user conversations</div>");
            }
        });
    };

    getConversations();

    const generateTable = conversations => {
        conversations.forEach(conversation => {
            let user = conversation.user2;
            let email = user.email;
            let name = user.firstName;
            let surname = user.lastName;

            let row = `<tr>
                        <td>${email}</td>
                        <td>${name}</td>
                        <td>${surname}</td>
                        <td><button class="btn btn-primary">Open</button></td>
                    </tr>`;

            $("#conversationsTableBody").append(row);
        });
    };
    
</script>